<!DOCTYPE html>
<html>
  <head>
    <title>Calendar GUI</title>
    <script src="jquery-3.7.1.min.js" ></script>
    <style>
      .timepart {
        width: 3em;
      }

      .day {
        text-align: left;
        vertical-align: top;
        width: 120px;
        height: 80px;
      }

      .year_field {
         width: 4em;
         border: 0px;
         font-weight: bold;
      }
      .month_field {
         border: 0px;
         font-weight: bold;
      }
      .day_field {
         width: 3em;
         border: 0px;
         font-weight: bold;
      }
      
      .hour {
        text-align: left;
        vertical-align: top;
        width: 900px;
        height: 100px;
      }
      
      #ui {
         border: 1px solid;
      }

      .today {
        font-weight: bold;
        text-decoration: underline;
      }

      caption {
        caption-side: top;
        text-align: center;
      }

      .prev {
        text-align: left;
      }
      .next {
        text-align: right;
      }

      .dark01 { background-color: rgb(0,     0,   0); color: rgb(256, 256, 256); }
      .dark02,.dark24 { background-color: rgb(22,   22,  22); color: rgb(234, 234, 234); }
      .dark03,.dark23 { background-color: rgb(44,   44,  44); color: rgb(212, 212, 212); }
      .dark04,.dark22 { background-color: rgb(66,   66,  66); color: rgb(190, 190, 190); }
      .dark05,.dark21 { background-color: rgb(88,   88,  88); color: rgb(190, 190, 190); }
      .dark06,.dark20 { background-color: rgb(110, 110, 110); color: rgb(190, 190, 190); }
      .dark07,.dark19 { background-color: rgb(132, 132, 132); color: rgb(212, 212, 212); }
      .dark08,.dark18 { background-color: rgb(154, 154, 154); color: rgb(212, 212, 212); }
      .dark09,.dark17 { background-color: rgb(176, 176, 176); color: rgb( 80,  80,  80); }
      .dark10,.dark16 { background-color: rgb(198, 198, 198); color: rgb( 58,  58,  58); }
      .dark11,.dark15 { background-color: rgb(220, 220, 220); color: rgb( 36,  36,  36); }
      .dark12,.dark14 { background-color: rgb(242, 242, 242); color: rgb( 14,  14,  14); }
      .dark13 { background-color: rgb(256, 256, 256); color: rgb(  0,   0,   0); }
    </style>
  </head>

   <body>
     <div id="calendar" style="width: 99%">
       <form name="calendar" action="" method="GET">
         <div style="padding: 5px;">
           <label>
             Calendar: <select name="kind" id="kind"></select>
           </label>
           <label>
             TimeZone: <select name="zone" id="zone"></select>
           </label>
           <span style="text-align: right;">
             Time: <span class="time beforenoon">
               <span id="hour" class="timepart"></span>:<span id="minute" class="timepart"></span>:<span id="second" class="timepart"></span>
             </span>
           </span>
         </div>
         <div style="padding: 5px;">
         </div>
       </form> 

       <table id="ui" border>
         <thead>
           <tr class="row1">
             <th class="cell1"><input name="year" type="number" min="1970" max="2035" class="year year_field"></th>
             <th class="cell2 middle"><select name="month" class="month" class="month_field"></select></th>
             <th class="cell3"><input name="day" type="number" min="1" max="31" class="day day_field"></th>
           </tr>
           <tr class="row2">
             <td></td>
             <th class="cell1 middle">
               <div style="text-align: center; display: flex; justify-content: space-evenly;">
                 <label> Display: <select name="display" id="display"></select></label>

                 <label>First Minute: <select id="first_minute"></select></label>
                 <!-- ^ case hour -->
                 <label>First Hour: <select   id="first_hour"></select></label>
                 <!-- ^ case day -->
                 <label>First Day: <select    id="first_day"></select></label>
                 <!-- ^ case 'week' || 'work' || 'month' -->
                 <label>First Month: <select  id="first_month"></select></label>
                 <!-- ^ case 'quarter' || 'year' -->
               </div>
             </th>
             <td></td>
           </tr>
         </thead>
         <tbody class="container"></tbody>
       </table>
     </div>
  </body>


  <script async>
    const calendar = $('#calendar');
    const months   = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const days     = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const storage_items = ['display', 'kind', 'zone'];
    const options = {
      hour: {
        display: 'Hour',
        first: 'minute',
        options: {
          'top': 'Top of the hour',
          'now': 'Now'
        }
      },
      day: {
        display: 'Day',
        first: 'hour',
        options: {
          'midnight': 'Midnight',
          'now': 'Current'
        }
      },
      week: {
        display: 'Week',
        first: 'day',
        options: {
          'today': 'Today',
        }
      },
      work: {
        display: 'Work Week',
        first: 'day',
        options: {
          'today': 'Today',
        }
      },
      month: {
        display: 'Month',
        first: 'day',
        options: {
          'today': 'Today',
        }
      },
      quarter: {
        display: 'Quarter',
        first: 'month',
        options: {
          'first': 'First',
          'last': 'Last'
        }
      },
      year: {
        display: 'Year',
        first: 'month',
        options: {
          'quarter': 'Quarter', 
          'current': 'Current'
        }
      }
    };
    days.forEach((d)   => options.week.options[d.toLowerCase()] = d);
    months.forEach((m) => options.year.options[m.toLowerCase()] = m);
    var now        = new Date();
    
    function capitalize(v){ return v[0].toUpperCase() + v.slice(1);    }
    function fmt(v) {       return ( parseInt(v) < 10 ) ? `0${v}` : v; }
    function monthToString(m) { return months[m]; }
    function quarterFromMonth(v) { return Math.ceil((v + 1) / 3); }

    function updateDateTime() {
      now = new Date('Nov 3 2024 00:00');
      $('input.year').val(parseInt(now.getFullYear()));
      $('input.day').val(fmt(parseInt(now.getDate())));

      $('#hour').text(fmt(now.getHours()));
      $('#minute').text(fmt(now.getMinutes()));
      $('#second').text(fmt(now.getSeconds()));
      
      $('.time').removeClass().addClass( `dark${fmt(now.getHours())}` );
      $('.time').css('padding', '5px');
    }

    $('input.year,select.month,input.day').on('mouseover', function () {
      $(this).css({'border': '1px solid'});
    }).on('mouseout', function () {
      $(this).css({'border': '0px solid'});
    });

    storage_items.forEach(function (v) {
      $(`#${v}`).on('blur', function () {
        populateStorage($(this).attr('id'));
      });
    });

    function updateWDays(parent, abbrev) {
      parent.empty();
      let val = parent.find('.first').val();
      let first = ( val == 'week:today' ) ? now.getDay() : 0;
      let sorted_days = [...days.slice(first, 7), ...days.slice(0, first)];
      abbrev ??= false;
      if ( $('#display').val() == 'work' ) {
        sorted_days = sorted_days.slice(0, 5)
      }
      sorted_days.forEach(function (v, i) {
        parent.append(`<th id="row${i}">${( abbrev === true ) ? v.slice(0, 3) : v}</th>`);
      });
    }
    function populateStorage(e) {
      let el = $(`#${e}`);
      let val = ( el.prop('tagName').toLowerCase() == 'select' ) ? el.children('option:selected').val() : el.val();
      localStorage.setItem(e, val);
    }
    function loadStorage(e) {
      let el = $(`#${e}`);
      if ( el.prop('tagName').toLowerCase() == 'select' ) {
        val = localStorage.getItem(e);
        el.each(function (i, v) {
          $(v).prop('selected', ( $(v).val() != val ) ? null : 'selected');
        });
      } else {
        el.val(localStorage.getItem(e));
      }
    }

    function loopy(parent, init, limit, func) {
       for (let i=init; i < limit; i++) {
         parent.append(func(i));
       }
    }

    function buildCalendar(parent, year, month, abbrev) {
      parent ??= $('#ui .container');
      year ??= now.getFullYear();
      month ??= now.getMonth();
      updateWDays(parent.find('.wdays'), abbrev);
      let rowi = 1;
      let row = parent.append(`<tr class="row${rowi}">`)
      loopy(row, 1, 32, function (i) {
        row.append(`<td class="cell${i} day ${(i == now.getDate()) ? ' today' : '' }" data-year="${year}" data-month="${month}" data-date="${i}">${fmt(i)}</td>`);
        if ( i % 7 == 0 ) {
          parent.append(`<tr class="row${rowi++}">`);
        }
      });
    }

    function loadUI(display, format) {
      $('#ui .container').empty();
      let rowi = 1, row, cell, tbl, cspan = null;
      switch (display) {
        case 'hour':
          loopy($('#ui .container'), 0, 60, (i) => `<tr class="row${i+1}"><td colspan="3" class="cell1 hour"><span class="time">${fmt(now.getHours())}:${fmt(i)}</span></td></tr>`);
          break;
        case 'day':
          loopy($('#ui .container'), 0, 24, (i) => `<tr class="row${i+1}"><td colspan="3" class="cell1 hour">${fmt(i)}</td></tr>`);
          break;
        case 'week':
          row = $('<tr class="days row1">');
          loopy(row, 1, 8, (i) => `<td class="cell${i} day">${fmt(i)}</td>`);
          $('#ui .container').append(row);
          cspan = 5;
          break;
        case 'work':
          row = $('<tr class="days row1">');
          loopy(row, 1, 6, (i) => `<td class="cell${i} day">${fmt(i)}</td>`);
          $('#ui .container').append(row);
          cspan = 3;
          break;
        case 'month':
          buildCalendar()
          cspan = 5;
          break;
        case 'quarter':
          row = $('<tr class="months row1"><td class="cell0"></td></tr>');
          months.filter((e, i) => quarterFromMonth(i) === quarterFromMonth(now.getMonth())).forEach(function (v, i) {
            cell = row.append(`<td class="cell${i++}">`); 
            tbl  = cell.append('<table cellpadding="0" cellspacing="0" border>');
            tbl.append(`<caption>${v}</caption>`);
            tbl.append('<thead><tr class="wdays">');
            tbl.append('<tbody class="days">');
            tbl.append('<tfoot>');
          });
          row.append(`<td class="cell${months.length}">`);
          $('#ui .container').append(row);

          buildCalendar($('#ui .days'));
          cspan = 6;
          break;
        case 'year':
          loopy($('#ui .container'), 1, 5, (i) => `<tr class="row${i} quarter${i}"><td class="cell1"></td></tr>`);
          let j
          months.forEach(function (v, i) {
            j = $(`#ui .quarter${quarterFromMonth(i)}`).find('td').length + 1;
            $(`#ui .quarter${quarterFromMonth(i)}`).append(`<td class="cell${j}"><table cellpadding="0" cellspacing="0" border><caption>${v}</caption><thead><tr class="wdays"></tr></thead><tbody class="days"></tbody><tfoot></tfoot></table></td>`)
          });
          for ( let i = 1; i < 5; i++ ) {
            j = $(`#ui .quarter${i}`).find('td').length + 1;
            $(`#ui .quarter${i}`).append(`<td class="cell${j}">`); 
          }

          buildCalendar($('#ui .days'), null, null, true);
          cspan = 3;
          break;
        default:
          alert(`Unknown display type: "${display}".`)
          return
      }

      if ( ['week', 'work', 'month', 'quarter'].includes(display) ) {
        $('#ui thead').append(`<tr class="row3 ${( display == 'quarter' ) ? 'month' : 'wdays'}">`);
      }

      Object.entries(options).forEach(function ([key, opt]) {
        Object.entries(opt.options).forEach(function ([val, txt]) {
          let eid = `#first_${opt.first}`;
          if ( $(eid).find(`option[value="${val}"`).length == 0 ) {
            $(eid).append(`<option value="${val}">${txt}</option>`);
          }
        });
      });

      if ( ['week', 'work', 'month'].includes(display) ) {
        updateWDays($('#ui').find('.wdays'));
      }
      $('#ui').prepend(`<caption>${capitalize(display)}</caption>`);
      $('#ui').append('<tfoot><tr><td class="prev"> << </td><td class="middle">&nbsp;</td><td class="next"> >> </td></tr></tfoot>');
      $('#ui .middle').attr('colspan', String(cspan)).attr('colspan', Number(cspan));
    }

    function load() {
      Intl.supportedValuesOf('calendar').forEach(function (e) {
        let sel = (e == 'gregory') ? ' selected="selected"' : ' ';
        $('#kind').append(`<option value="${e}"${sel}>${capitalize(e)}</option>`);
      });
      Intl.supportedValuesOf('timeZone').forEach(function (e) {
        let sel = (e == 'America/Los_Angeles') ? ' selected="selected"' : '';
        $('#zone').append(`<option value="${e}"${sel}>${e}</option>`);
      });

      storage_items.forEach(function (e) {
        let db = ( ! localStorage.getItem(e) || localStorage.getItem(e) === 'undefined' ) ? populateStorage : loadStorage;
        db(e);
      });

      Object.entries(options).forEach(function ([key, val]) {
        $('#display').append(`<option value="${key}">${val.display}</option>`);
      });

      $('#display,#kind,#zone').children('option').each(function (i, v) {
        $(v).prop('selected', ( $(v).val() != localStorage.getItem($(v).parent('select').attr('id')) ) ? null : 'selected');
      });

      //loadUI('hour');
      //loadUI('day');
      //loadUI('week');
      //loadUI('work');
      //loadUI('month');
      //loadUI('quarter');
      loadUI('year');
      $('#month').empty();
      months.forEach(function (v, i) {
        let sel = ( i == now.getMonth() ) ? ' selected="selected"' : '';
        $('select.month').append(`<option value="${i}"${sel}>${capitalize(v)}</option>`);
      });

      console.log(`Loaded: ${now}.`);
    }
    $(document).ready(load);
    setInterval(updateDateTime, 100);
  </script>
</html>
